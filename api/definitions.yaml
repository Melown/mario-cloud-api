#===============================================================================
# Definitions

#-------------------------------------------------------------------------------
# Error
Error:
  type: object
  properties:
    status:
      type: integer
      description: HTTP-Status.
    message:
      type: string
      description: Copyright notice.

#-------------------------------------------------------------------------------
# Credit
Credit:
  type: object
  properties:
    id:
      type: string
      description: Credit's string-id.
    numeric_id:
      type: integer
      description: Credit's numeric id.
    notice:
      type: string
      description: Copyright notice.
    flag_used:
      type: boolean
      description: '- TODO: not used -'

#-------------------------------------------------------------------------------
# Invitation
Invitation:
  type: object
  properties:
    token:
      type: string
      description: Token for this invitation.
    email:
      type: string
      description: Email of the receiver of this invitation.
    time_send:
      type: string
      format: date-time
      description: dateTime when the invitation was last sent.

#-------------------------------------------------------------------------------
# NewInvitation
NewInvitation:
  type: object
  required: [email]
  properties:
    email:
      type: string
      description: Receiver-email.
    count:
      type: integer
      description: 'How often this invitation can be accepted (optional,
        defaults to 0 - unlimited).'
    time_valid_until:
      type: string
      format: date-time
      description: 'Until when this invitation can be accepted (optional,
        defaults to null - forever).'

#-------------------------------------------------------------------------------
# User in Account
Account.User:
  type: object
  properties:
    id:
      type: integer
      description: User's numeric id.
    email:
      type: string
      description: User's email.
    name:
      type: string
      description: User's full name.
    role:
      type: string
      description: User's role in that account.

#-------------------------------------------------------------------------------
# Account - limited data
AccountSimple:
  type: object
  title: 'Account (for non-members)'
  properties:
    id:
      type: integer
      description: Account's numeric id.
    alias:
      type: string
      description: Account-alias, derived from email.
    name:
      type: string
      description: Name of the account.

#-------------------------------------------------------------------------------
# Account - full data
AccountFull:
  type: object
  title: 'Account (full)'
  allOf:
    - $ref: '#/AccountSimple'
    - type: object
      properties:
        billing_plan_alias:
          type: string
          description: Alias of the billing plan.
        time_created:
          type: string
          format: date-time
          description: dateTime when this account was created.
        time_modified:
          type: string
          format: date-time
          description: dateTime when this account was last modified.
        credits:
          type: array
          items:
            $ref: '#/Credit'
        users:
          type: array
          items:
            $ref: '#/Account.User'
        invitations:
          type: array
          items:
            $ref: '#/Invitation'
        dataset_quota_mb:
          type: integer
          description: Quota for uploading datasets in MB.

#-------------------------------------------------------------------------------
# Account in User
User.Account:
  type: object
  allOf:
    - $ref: '#/AccountSimple'
    - type: object
      properties:
        user_role:
          type: string
          description: Current user's role in that account.
        dataset_quota_mb:
          type: integer
          description: Quota for uploading datasets in MB.

#-------------------------------------------------------------------------------
# Profile
Profile:
  type: object
  properties:
    id:
      type: integer
      description: User's numeric id.
    email:
      type: string
      description: User's email.
    name:
      type: string
      description: User's full name.
    flag_admin:
      type: boolean
      description: True if the user is a super-admin.
    accounts:
      type: array
      description: Accounts the user is a member of.
      items:
        $ref: '#/User.Account'

#-------------------------------------------------------------------------------
# Dataset in UpdatedDatasets in analytics
UpdatedDatasets.Dataset:
  type: object
  properties:
    dataset_id:
      type: integer
      description: Numeric ID of the dataset.
    name:
      type: string
      description: Name of the dataset.
    time_edited:
      type: string
      format: date-time
      description: dateTime when the dataset was edited last time.
    time_created:
      type: string
      format: date-time
      description: dateTime when the dataset was created.
    format:
      type: string
      description: "Type of this dataset, e.g 'gtiff', 'tls'."
    account_id:
      type: integer
      description: Numeric ID of the account owning the map.
    account_alias:
      type: string
      description: Alias of the account owning the map.

#-------------------------------------------------------------------------------
# AnalyticsResult in analytics
AnalyticsResult:
  type: object
  properties:
    totalCount:
      type: integer
      description: Total number of items in result.
    pagesCount:
      type: integer
      description: Number of result-pages.
    offset:
      type: integer
      description: Offset of current page in result.
    currentPage:
      type: integer
      description: Current result-page.

#-------------------------------------------------------------------------------
# UpdatedDatasets in analytics
UpdatedDatasets:
  type: object
  allOf:
      - $ref: '#/AnalyticsResult'
      - type: object
        properties:
          updatedDatasets:
            type: array
            description: 'Result: List of datasets.'
            items:
              $ref: '#/UpdatedDatasets.Dataset'

#-------------------------------------------------------------------------------
# MapConfig in UpdatedMaps in analytics
UpdatedMaps.MapConfig:
  type: object
  properties:
    name:
      type: string
      description: Name of the map.
    time_edited:
      type: string
      format: date-time
      description: dateTime when the map was edited last time.
    time_created:
      type: string
      format: date-time
      description: dateTime when the map was created.
    app:
      type: string
      description: Application-ID.
    map_config_id:
      type: integer
      description: Numeric ID of map.
    working_copy_for_map_config_id:
      type: string
      description: If not null, then this is the working-copy for that map.
    account_id:
      type: integer
      description: Numeric ID of the account owning the map.
    account_alias:
      type: string
      description: Alias of the account owning the map.

#-------------------------------------------------------------------------------
# UpdatedMaps in analytics
UpdatedMaps:
  type: object
  allOf:
      - $ref: '#/AnalyticsResult'
      - type: object
        properties:
          updatedMaps:
            type: array
            description: 'Result: List of maps.'
            items:
              $ref: '#/UpdatedMaps.MapConfig'

#-------------------------------------------------------------------------------
# Application
Application:
  type: object
  properties:
    id:
      type: string
      description: ID of this application.
    authorization_url:
      type: string
      description: URL.
    map_config_url:
      type: string
      description: URL to the map-configuration file.
    title:
      type: string
      description: Public title of the map, including copyright.

#-------------------------------------------------------------------------------
# Usage (quota info)
Usage:
  type: object
  properties:
    quota:
      type: integer
      description: Quota for uploading datasets for this account in bytes.
    used:
      type: integer
      description: Bytes already used.

#-------------------------------------------------------------------------------
# File in Dataset
Dataset.File:
  type: object
  properties:
    byte_size:
      type: integer
      description: Filesize of this file in bytes.
    crc:
      type: string
      description: Checksum - not used, always empty string.
    path:
      type: string
      description: Relative path inside store.
    progress:
      type: number
      description: 'Upload-progress in %.'
    upload_byte_offset:
      type: integer
      description: While uploading, current offset.

#-------------------------------------------------------------------------------
# Resource in Dataset
Dataset.Resource:
  type: object
  properties:
    id:
      type: integer
      description: ID of this resource.
    name:
      type: string
      description: Name given by the exporter.
    caption:
      type: string
      description: 'TODO: CHECK: Additional title.'

#-------------------------------------------------------------------------------
# Make in Dataset
MakeResult:
  type: object
  properties:
    analyse_target_id:
      type: integer
      description: "TODO: MORE DATA: Analyse-target."

#-------------------------------------------------------------------------------
# Dataset
Dataset:
  type: object
  properties:
    id:
      type: integer
      description: ID of this dataset.
    name:
      type: string
      description: Name given by the uploader.
    owner_account_id:
      type: string
      description: Account-ID of the owner's account.
    type:
      type: string
      description: Type of dataset.
    status:
      type: string
      enum: [analysing, corrupted, deleted, export_failed, exported, exporting, ready, uploading]
      description: Overall status this dataset is currently in.
    progress:
      type: number
      description: 'Progress of current operation on this dataset, if any, in %. 0 otherwise.'
    byte_size:
      type: integer
      description: Filesize of this dataset in bytes.
    area:
      type: number
      description: 'TODO: CHECK: Not used, always 0.'
    make:
      $ref: '#/MakeResult'
    time_created:
      type: string
      format: date-time
      description: dateTime when this dataset was created.
    time_edited:
      type: string
      format: date-time
      description: dateTime when this dataset was last modified.
    time_analyse_started:
      type: string
      format: date-time
      description: dateTime when anaylsis was started for this dataset. Can be null.
    time_export_started:
      type: string
      format: date-time
      description: dateTime when an export was started for this dataset. Can be null.
    upload_progress:
      type: number
      description: 'While the dataset is uploading, the current progress in %.'
    analyse_progress:
      type: number
      description: 'While the dataset is being analysed, the current progress in %.'
    export_progress:
      type: number
      description: 'While the dataset is exporting, the current progress in %.'
    analyse_status:
      type: string
      enum: [complete, error, ready, underway]
      description: 'Current status of the last analyse-operation. Can be `null`
        if analysis was not yet started.'
    export_status:
      type: string
      enum: [complete, error, ready, underway]
      description: 'Current status of the last export-operation. Can be `null`
        if the dataset was never exported.'
    category:
      type: string
      enum: [Feature, Imagery, Special, Stylesheet, Surface, True3D]
      description: Category of resource this dataset belongs to.
    format:
      type: string
      description: Type of this dataset, e.g 'gtiff', 'tls'.
    format_detail:
      type: string
      description: 'TODO: CHECK: Details of format. Not used, always `null`.'
    files:
      type: array
      description: 'List of files belonging to this dataset.'
      items:
        $ref: '#/Dataset.File'
    resources:
      type: array
      description: 'List of resources exported from this dataset.'
      items:
        $ref: '#/Dataset.Resource'

#-------------------------------------------------------------------------------
# Datasets in Account
Account.Datasets:
  type: object
  properties:
    usage:
      $ref: '#/Usage'
    datasets:
      type: array
      description: 'Result: List of datasets.'
      items:
        $ref: '#/Dataset'

#-------------------------------------------------------------------------------
# Datasets in Account
DatasetReferences:
  type: object
  additionalProperties:
    type: object
    description: "Key is the dataset-ID."
    properties:
      resources:
        type: array
        description: 'List of resource-IDs.'
        items:
          type: integer
          description: Resource-ID.
      maps:
        type: array
        description: 'List of map-IDs.'
        items:
          type: integer
          description: Map-ID.

#-------------------------------------------------------------------------------
# Basic MapConfig
MapConfigBasic:
  type: object
  properties:
    alias:
      type: string
      description: Alias derived from name.
    path:
      type: string
      description: Relative path of this map-config in store.
    name:
      type: string
      description: Name of the map.

#-------------------------------------------------------------------------------
# Extended MapConfig
MapConfigExtended1:
  type: object
  allOf:
    - $ref: '#/MapConfigBasic'
    - type: object
      properties:
        id:
          type: integer
          description: Numeric ID of this map.
        has_changes:
          type: boolean
          description: True if this map was modified, and not yet published (a working-copy exists).
        owner_account_id:
          type: string
          description: Account-ID of the owner's account.
        reference_frame_id:
          type: string
          description: ID of the reference frame this map uses.
        time_edited:
          type: string
          format: date-time
          description: dateTime when the map was edited last time.
        time_created:
          type: string
          format: date-time
          description: dateTime when the map was created.
        time_saved:
          type: string
          format: date-time
          description: dateTime when the map was saved last time.

#-------------------------------------------------------------------------------
# Extended MapConfig 2
MapConfigExtended2:
  type: object
  properties:
    description:
      type: string
      description: Description of the map.
    rotation:
      type: number
      description: Rotation-value this map uses.
    title:
      type: string
      description: Title of the map.
    position:
      type: string
      description: JSON representing the position the map shows.
    flag_example:
      type: boolean
      description: True if this map is one of the examples every account initially receives.
    resources:
      type: array
      description: 'List of resources this map uses.'
      items:
        type: integer
        description: Resource-ID'

#-------------------------------------------------------------------------------
# MapConfig - working copy
MapDetail.MapConfig.Workingcopy:
  type: object
  allOf:
    - $ref: '#/MapConfigBasic'
    - $ref: '#/MapConfigExtended2'

#-------------------------------------------------------------------------------
# MapConfig in single map route
MapDetail.MapConfig:
  type: object
  allOf:
    - $ref: '#/MapConfigExtended1'
    - $ref: '#/MapConfigExtended2'
    - type: object
      properties:
        app:
          type: string
          description: Application-ID.
        working:
            $ref: '#/MapDetail.MapConfig.Workingcopy'

#-------------------------------------------------------------------------------
# ReferenceFrame
ReferenceFrame:
  type: object
  properties:
    display_order:
      type: integer
      description: For ordering in the frontend. Currently always 1.
    flag_public:
      type: boolean
      description: 'TODO: CHECK: True if this is a public reference frame.'
    id:
      type: string
      description: ID of this reference frame.
    name:
      type: string
      description: Human readable name.
    position:
      type: string
      description: JSON representing the initial position for this reference frame.
    short:
      type: string
      description: Short name.

#-------------------------------------------------------------------------------
# ReferenceFrameList
ReferenceFrameList:
  type: array
  items:
    $ref: '#/ReferenceFrame'

#-------------------------------------------------------------------------------
# ResourceCategory
ResourceCategory:
  type: object
  properties:
    id:
      type: string
      description: ID of this category.
    label:
      type: string
      description: Human readable name.

#-------------------------------------------------------------------------------
# ResourceCategoryList
ResourceCategoryList:
  type: array
  items:
    $ref: '#/ResourceCategory'

#-------------------------------------------------------------------------------
# Resource
Resource:
  type: object
  properties:
    alias:
      type: string
      description: Alias this resource.
    caption:
      type: string
      description: Human readable title of resource.
    description:
      type: string
      description: Description of this resource.
    flag_default:
      type: boolean
      description: 'TODO: CHECK: True if this is a default-resource that comes with a new account.'
    flag_deletable:
      type: boolean
      description: True if this resource can be deleted (was uploaded by the user).
    flage_private:
      type: boolean
      description: 'TODO: CHECK: True if this resource is usable only by the owner account.'
    id:
      type: integer
      description: Numeric ID of this resource.
    name:
      type: string
      description: Name of this resource.
    owner_account_id:
      type: string
      description: Account-ID of the owner's account.
    reference_frame_id:
      type: string
      description: ID of the reference frame this map uses.
    resource_category_id:
      type: string
      description: ID of the resource-category this resource belongs to.
    resource_type_id:
      type: string
      description: ID of the type of this resource.
    time_created:
      type: string
      format: date-time
      description: dateTime when this resource was created.
    time_modified:
      type: string
      format: date-time
      description: dateTime when this resource was last modified.

# NewDataset
NewDataset:
  type: object
  required: [name, type]
  properties:
    name:
      type: string
      description: Name given by the uploader.
    type:
      type: string
      description: Type of dataset.

# MapApplication
MapApplication:
  type: object
  properties:
    authorization_url:
      type: string
      description: 'TODO: clarify: URL for authorization.'
    id:
      type: string
      description: Appliction-ID.
    map_config_url:
      type: string
      description: Location of the map-configuration.
    title:
      type: string
      description: Map-title including copyright.
    description_html:
      type: string
      description: "TODO: description."
